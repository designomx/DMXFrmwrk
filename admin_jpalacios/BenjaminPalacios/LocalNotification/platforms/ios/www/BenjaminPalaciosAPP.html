<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <meta name="viewport" content="width=1,initial-scale=1,user-scalable=1" />
  <meta http-equiv="Content-Security-Policy"/>
  <title>Benjamin Palacios</title>
  
  
  <link rel="stylesheet" type="text/css" href="assets/bootstrap/css/bootstrap.css" />
  <link rel="stylesheet" type="text/css" href="assets/bootstrap/css/font-awesome.css" />
  <link rel="stylesheet" type="text/css" href="assets/bootstrap/css/bootstrap-social.css" />
  <link rel="stylesheet" type="text/css" href="assets/bootstrap/css/bootstrap-switch.css" />
  <link href="assets/bootstrap/css/highlight.css" rel="stylesheet"/>

  <link rel="stylesheet" type="text/css" href="assets/css/styles.css" />

  <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css">

<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
  <div id="container" class="container">
    <div id="body" class="login-form">
      <section class="controles">
        <img src="img/Logo.png" class="img-responsive" alt="" />
        <span class="input-group form-control">
          <span class="pull-left" id="">Despertador y Alimentos</span>
          <span class="pull-right">
            <input name="despertador" class="pull-right" data-size="small" data-off-text="&nbsp;" data-off-color="danger" data-on-text="&nbsp;" data-on-color="success" data-inverse="true" type="checkbox" >
          </span>
        </span>   
        <div class="pull-left col-xs-8 col-sm-8 col-md-16 texto-izq">
            <span class=" form-control input-lg">8:00 AM</span>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-16 texto-der">
            <input id="repetidor1" type="number" inputmode="numeric" pattern="[0-9]*" name="cantidad" class="input-lg form-control" placeholder="1" min="1" max="5" value=1 required>
        </div>
        <span class="input-group form-control">
          <span class="pull-left" id="">Alimentos y Entrenamiento</span>
          <span class="pull-right">
            <input name="alimentos" class="pull-right" data-size="small" data-off-text="&nbsp;" data-off-color="danger" data-on-text="&nbsp;" data-on-color="success" data-inverse="true" type="checkbox" >
          </span>
        </span>   
        <div class="col-xs-8 col-sm-8 col-md-16 texto-izq">    
            <span class="form-control input-lg">7:40 AM</span>
        </div>
        <div class="col-xs-4 col-sm-4 col-md-16 texto-der">
            <input id="repetidor2" type="number" pattern="\d*" name="cantidad" class="input-lg form-control" placeholder="1" min="1" max="5" value=1 required>
        </div>
        <span class="input-group form-control">
          <span class="pull-left" id="">Hidratación</span>
          <span class="pull-right">
            <input name="hidratacion" class="pull-right" data-size="small" data-off-text="&nbsp;" data-off-color="danger" data-on-text="&nbsp;" data-on-color="success" data-inverse="true" type="checkbox" >
          </span>
        </span>   
        <span class="input-group form-control">
          <span class="pull-left" id="">Recordatorios directos</span>
          <span class="pull-right">
            <input name="recordatorios" class="pull-right" data-size="small" data-off-text="&nbsp;" data-off-color="danger" data-on-text="&nbsp;" data-on-color="success" data-inverse="true" type="checkbox" >
          </span>
        </span>
        <br><br>
        <div class="text-center">
          <a class="btn btn-social-icon btn-github">
            <span class="fa fa-twitter"></span>
          </a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <a class="btn btn-social-icon btn-github">
            <span class="fa fa-facebook"></span>
          </a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <a class="btn btn-social-icon btn-github">
            <span class="fa fa-youtube"></span>
          </a>
        </div>

        <!-- schedule 
            <h2 class="section">Schedule</h2>
            <div class="container">
                <div onclick="schedule()">Single<br /><span>schedule(1)</span></div>
                <div onclick="scheduleMultiple()">Multiple<br /><span>schedule(1, 2, 3)</span></div>
            </div>
            <div class="container">
                <div onclick="scheduleDelayed()">In 5 sec<br /><span>schedule(1, firstAt:later)</span></div>
                <div onclick="scheduleMinutely()">Every min<br /><span>schedule(1, every:minute)</span></div>
            </div>
        -->


      </section>
    </div>
  </div>
  <footer id="footer" class="footer">
        <label>www.benjaminpalacios.net</label>
    </footer>
  
  
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap.min.js"></script>
  <script src="assets/bootstrap/js/bootstrap-switch.min.js"></script>
  <script>
    $(function(argument) {
      $('[type="checkbox"]').bootstrapSwitch();
    })
    </script>

  <script type="text/javascript">
      //set initial state.
      //$('#textbox1').val($(this).is(':checked'));
      $('input[name="despertador"]').on('switchChange.bootstrapSwitch', function(event, state) {
          if(state==true){
            //alert("cambio a verde");
            window.localStorage.setItem("despertador","1");
            agregar_DESPERTADORyALIMENTOS();
            localStorage.despertador=1;
          }else{
            //alert("cambio a rojo");
            window.localStorage.setItem("despertador","0");
            cancelar(0);
            cancelar(1);
            cancelar(2);
            cancelar(3);
            cancelar(4);  
            limpiarALL();
            localStorage.despertador=0;
          }
      });
      $('input[name="alimentos"]').on('switchChange.bootstrapSwitch', function(event, state) {
          if(state==true){
            window.localStorage.setItem("alimentos","1");      
            agregar_ALIMENTOSyENTRENAMIENTO();   
            localStorage.alimentos=1;   
          }else{
            window.localStorage.setItem("alimentos","0");
            cancelar(10);
            cancelar(11);
            cancelar(12);
            cancelar(13);
            cancelar(14);
            limpiarALL();
            localStorage.alimentos=0;
          }
      });
      $('input[name="hidratacion"]').on('switchChange.bootstrapSwitch', function(event, state) {
          if(state==true){
            window.localStorage.setItem("hidratacion","1");      
            add_reminder(2,'Mensaje de Hidratación',0,9,0,'Hidratación!');
            localStorage.hidratacion=1;
          }else{
            window.localStorage.setItem("hidratacion","0");
            cancelar(2);
            limpiarALL();
            localStorage.hidratacion=0;
          }
      });
      $('input[name="recordatorios"]').on('switchChange.bootstrapSwitch', function(event, state) {
          if(state==true){
            window.localStorage.setItem("recordatorios","1");          
            add_reminder(3,'Recordatorios Directos',0,11,0,'Recordatorios!');
            localStorage.recordatorios=1;
          }else{
            window.localStorage.setItem("recordatorios","0");
            canelar(3);
            limpiarALL();
            localStorage.recordatorios=0;
          }
      });

    $( "#repetidor1" ).change(function() {
      //alert( "entra a change" );
      if(window.localStorage.getItem("despertador")==1){
        agregar_DESPERTADORyALIMENTOS();
      }
    });

    $( "#repetidor2" ).change(function() {
      if(window.localStorage.getItem("alimentos")==1){
        agregar_ALIMENTOSyENTRENAMIENTO();
      }
    });
  </script>

  <script type="text/javascript">

    function agregar_DESPERTADORyALIMENTOS() {
      // body...
      if ($("#repetidor1").val() > 5)
        {
            $("#repetidor1").val(5);
            showToast('Máximo 5 repeticiones');
        }
        else if ($("#repetidor1").val() < 1)
        {
          alert("entra a menot que 1");
            $("#repetidor1").val(1);
            showToast('Mínimo 0 cancela esta notificación');
        }
        if($("#repetidor1").val()<=0){
          //Funcion para cancelar 
          cancelar(0);
          cancelar(1);
          cancelar(2);
          cancelar(3);
          cancelar(4); 
          limpiarALL();
        }else{
          //Funcion para agregar notificacion
          repeticiones1=$("#repetidor1").val();
          var minutos_repeticion =-5;
          for (var i = 0; i <= repeticiones1 -1; i++) {
            minutos_repeticion+=5;
            add_reminder(i,'Despertar y comer un desayuno bine balanceado',0,8,minutos_repeticion,'Despertarse y comer'); 
          }
        }
    }

    function agregar_ALIMENTOSyENTRENAMIENTO() {
      // body...
      if ($("#repetidor2").val() > 5)
        {
            $("#repetidor2").val(5);
            showToast('Máximo 5 repeticiones');
        }
        else if ($("#repetidor2").val() < 1)
        {
            $("#repetidor2").val(1);
            showToast('Mínimo 0 cancela esta notificación');
        }
        if($("#repetidor2").val()<=0){
          //Funcion para cancelar 
          cancelar(10);
          cancelar(11);
          cancelar(12);
          cancelar(13);
          cancelar(14);  
          limpiarALL();
        }else{
          //Funcion para agregar notificacion
          repeticiones2=Number($("#repetidor2").val())+10;
          var minutos_repeticion2=35;
          for (var i = 10; i <= repeticiones2 -1; i++) {
            minutos_repeticion2+=5;
            add_reminder(i,'Después de comer hay que entrenar',0,8,minutos_repeticion2,'Alimentos y Entrenamiento'); 
          }
        }
    }


  </script>


  <script type="text/javascript">
    function cancelar(id){
      cordova.plugins.notification.local.cancel(id, function() {
          //alert("done");
      }, this);
    }
    
    function limpiar(id){
      cordova.plugins.notification.local.clear(id, function() {
          //alert("done");
      }, this);
    }

    function cancelarALL(){
      cordova.plugins.notification.local.cancelAll(function() {
          //alert("done");
      }, this);
    }
    
    function limpiarALL(){
      cordova.plugins.notification.local.clearAll(function() {
          //alert("done");
      }, this);
    }
  </script>


  <script type="text/javascript" src="cordova.js"></script>


  <script type="text/javascript">
  function add_reminder(id,mensaje,repeticiones,hora,minutos,titulo)
  { 

      /*
      var schedule_time = new Date((date + " " + time).replace(/-/g, "/")).getTime();
      schedule_time = new Date(schedule_time);
      */
     
      var schedule_time = new Date();
      schedule_time.setHours(hora,minutos,00);
      var current_time = new Date().getTime();
      if(current_time>schedule_time){
        schedule_time.setDate(schedule_time.getDate() + 1);
      }  

      //var id = info.data.length;

      cordova.plugins.notification.local.hasPermission(function(granted){
        if(granted == true)
        {
          //alert(id+titulo+mensaje+schedule_time+hora+minutos+repeticiones);
          schedule(id, titulo, mensaje,schedule_time);
        }
        else
        {
          cordova.plugins.notification.local.registerPermission(function(granted) {
              if(granted == true)
              {
                //alert(id+titulo+message+schedule_time+hora+minutos+repeticiones);
                schedule(id, titulo, mensaje,schedule_time);
              }
              else
              {
                alert("Reminder cannot be added because app doesn't have permission");
              }
          });
        }
      });
  }
  </script>

  <!-- initialize -->
  <script type="text/javascript">
    function schedule(id, titulo, mensaje, schedule_time)
  {
      cordova.plugins.notification.local.schedule({
          id: id,
          title: titulo,
          message: mensaje,
          firstAt: schedule_time,
          //every:"minute",
          badge: true
      });

      //alert("Reminder added successfully")
      showToast("Notificación agregada con éxito!");
  }
  </script>

  <script type="text/javascript">
  document.addEventListener('deviceready', function () {

    cordova.plugins.notification.local.on('trigger', function (notification) {
                      console.log('ontrigger', arguments);
                      showToast('triggered: ' + notification.id,'short','center');
                      //alert("trigger"+notification.id);
                  });
    cordova.plugins.notification.local.on('click', function (notification) {
              console.log('onclick', arguments);
              showToast('clicked: ' + notification.id,'short','center');
              //alert("clicked"+notification.id+"Va a ser cancelada");
          });

    cordova.plugins.notification.local.on('cancel', function (notification) {
              console.log('oncancel', arguments);
              showToast('canceled: ' + notification.id);
              //alert("canceled"+notification.id);

          });     

  }, false);
</script>

<script type="text/javascript">
      var id = 1, dialog;

      callback = function () {
          cordova.plugins.notification.local.getIds(function (ids) {
              showToast('IDs: ' + ids.join(' ,'));
          });
      };

      showToast = function (text) {
          setTimeout(function () {
              if (device.platform != 'windows') {
                  window.plugins.toast.showShortBottom(text);
              } else {
                  //showDialog(text);
              }
          }, 100);
      };
</script>


<script type="text/javascript">
  var info = null;

  document.addEventListener("deviceready", function(){
    //alert("hola");
    document.addEventListener("resume", onResume, false);
    
  }, false);

  function onResume() {
    //Cargar lista de Notificaciones pendientes para que el usuario las acepte
    //alert(info.data[count][3])
    if(localStorage.despertador==0){
      limpiarALL();
      cancelar(0);
      cancelar(1);
      cancelar(2);
      cancelar(3);
      cancelar(4);
    }else if(localStorage.despertador==1){
        var schedule_time = new Date();
        schedule_time.setHours(8,0,00);
        var schedule_time_limit = new Date();
        schedule_time_limit.setHours(8,40,00);
        var current_time = new Date().getTime();
        if(current_time>schedule_time && current_time<schedule_time_limit){
          alert("Recuerde que tiene despertar temprano y alimentarse sano");
          limpiarALL();      
        }else{
          //Si ya pasó el tiempo que debería mostrarse
        }
    }
    if(localStorage.alimentos==0){
      limpiarALL();
      cancelar(10);
      cancelar(11);
      cancelar(12);
      cancelar(13);
      cancelar(14);
    }else if(localStorage.alimentos==1){
        var schedule_time = new Date();
        schedule_time.setHours(8,40,00);
        var schedule_time_limit = new Date();
        schedule_time_limit.setHours(09,20,00);
        var current_time = new Date().getTime();
        if(current_time>schedule_time && current_time<schedule_time_limit){
          alert("Recuerde que tiene que alimentarse bien y entrenar!");
          limpiarALL();      
        }else{
          //Si ya pasó el tiempo que debería mostrarse
        }
    }
    if(localStorage.hidratacion==0){
      limpiarALL();
      cancelar(20);
    }else if(localStorage.hidratacion==1){
        var schedule_time = new Date();
        schedule_time.setHours(9,0,00);
        var schedule_time_limit = new Date();
        schedule_time_limit.setHours(09,40,00);
        var current_time = new Date().getTime();
        if(current_time>schedule_time && current_time<schedule_time_limit){
          alert("Recuerde que tiene que hidratarse");
          limpiarALL();      
        }else{
          //Si ya pasó el tiempo que debería mostrarse
        }
    }
    if(localStorage.recordatorios==0){
      limpiarALL();
      cancelar(30);
    }else if(localStorage.recordatorios==1){
        var schedule_time = new Date();
        schedule_time.setHours(11,0,00);
        var schedule_time_limit = new Date();
        schedule_time_limit.setHours(11,40,00);
        var current_time = new Date().getTime();
        if(current_time>schedule_time && current_time<schedule_time_limit){
          alert("Recuerde que tiene que tiene recordatorios");
          limpiarALL();      
        }else{
          //Si ya pasó el tiempo que debería mostrarse
        }
    }
    
  }
</script>

</body>
</html>